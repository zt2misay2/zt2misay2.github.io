<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Misay_Transparent_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Misay_Transparent_16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="codeva-4ptLLapCzc">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.zt2misay2.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="UCSCCTF-WP">
<meta property="og:type" content="article">
<meta property="og:title" content="UCSCCTF2025">
<meta property="og:url" content="http://www.zt2misay2.cn/2025/04/20/UCSCCTF2025/index.html">
<meta property="og:site_name" content="Misay&#39;s blog">
<meta property="og:description" content="UCSCCTF-WP">
<meta property="og:locale">
<meta property="og:image" content="http://www.zt2misay2.cn/2025/04/20/UCSCCTF2025/a23109e014af45e430d4a069c4b5f3ec.png">
<meta property="article:published_time" content="2025-04-20T08:16:08.000Z">
<meta property="article:modified_time" content="2025-05-17T05:19:22.629Z">
<meta property="article:author" content="Misay">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="DLP">
<meta property="article:tag" content="ECC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.zt2misay2.cn/2025/04/20/UCSCCTF2025/a23109e014af45e430d4a069c4b5f3ec.png">

<link rel="canonical" href="http://www.zt2misay2.cn/2025/04/20/UCSCCTF2025/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>UCSCCTF2025 | Misay's blog</title>
  




  <script>
    !function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.growingio.com/2.1/gio.js","gio");
    gio('init', 'bca0505c749115b527248c0d2e1ad93a', {});
    gio('send');
  </script>


  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Misay's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://www.zt2misay2.cn/2025/04/20/UCSCCTF2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Misay">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Misay's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UCSCCTF2025
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-20 16:16:08" itemprop="dateCreated datePublished" datetime="2025-04-20T16:16:08+08:00">2025-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-05-17 13:19:22" itemprop="dateModified" datetime="2025-05-17T13:19:22+08:00">2025-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WP/" itemprop="url" rel="index"><span itemprop="name">WP</span></a>
                </span>
            </span>

          
            <div class="post-description">UCSCCTF-WP</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="/2025/04/20/UCSCCTF2025/a23109e014af45e430d4a069c4b5f3ec.png" alt></p>
<h2 id="1xr4"><a class="markdownIt-Anchor" href="#1xr4"></a> 1.XR4</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    cipher_bytes = base64.b64decode(cipher)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> cipher_bytes:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(s ^ k))</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">''</span>.join(res))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_num</span>(<span class="params">seed_num</span>):</span><br><span class="line">    random.seed(seed_num)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(random.random()*<span class="number">10000</span>)[<span class="number">0</span>:<span class="number">2</span>]) ^ (data[i])))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    ciphertext = <span class="string">"MjM184anvdA="</span></span><br><span class="line">    key = <span class="string">"XR4"</span></span><br><span class="line">    box = init_sbox(key)</span><br><span class="line">    a=decrypt(ciphertext, box)</span><br><span class="line">    random_num(<span class="built_in">int</span>(a))</span><br><span class="line"><span class="comment"># transposed_matrix=(data.reshape(6*6))^T</span></span><br><span class="line"><span class="comment"># transposed_matrix=[[  1 111  38 110  95  44]</span></span><br><span class="line"><span class="comment">#  [ 11  45  58  39  84   1]</span></span><br><span class="line"><span class="comment">#  [116  19 113  60  91 118]</span></span><br><span class="line"><span class="comment">#  [ 33  98  38  57  10  29]</span></span><br><span class="line"><span class="comment">#  [ 68  52 119  56  43 125]</span></span><br><span class="line"><span class="comment">#  [ 32  32   7  26  41  41]]</span></span><br></pre></td></tr></table></figure>
<p>类似RC4的流密码，解密思路是用密钥<code>XR4</code>解密密文<code>MjM184anvdA=</code>还原出随机数种子，用来重置随机数生成器，再恢复矩阵，最后生成随机数流逐位异或就能得到答案，exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># RC4初始化函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"></span><br><span class="line"><span class="comment"># RC4解密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    cipher_bytes = base64.b64decode(cipher)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> cipher_bytes:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(s ^ k)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 已知参数</span></span><br><span class="line">    ciphertext = <span class="string">"MjM184anvdA="</span></span><br><span class="line">    key = <span class="string">"XR4"</span></span><br><span class="line">    transposed_matrix = np.array([</span><br><span class="line">        [<span class="number">1</span>, <span class="number">111</span>, <span class="number">38</span>, <span class="number">110</span>, <span class="number">95</span>, <span class="number">44</span>],</span><br><span class="line">        [<span class="number">11</span>, <span class="number">45</span>, <span class="number">58</span>, <span class="number">39</span>, <span class="number">84</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">116</span>, <span class="number">19</span>, <span class="number">113</span>, <span class="number">60</span>, <span class="number">91</span>, <span class="number">118</span>],</span><br><span class="line">        [<span class="number">33</span>, <span class="number">98</span>, <span class="number">38</span>, <span class="number">57</span>, <span class="number">10</span>, <span class="number">29</span>],</span><br><span class="line">        [<span class="number">68</span>, <span class="number">52</span>, <span class="number">119</span>, <span class="number">56</span>, <span class="number">43</span>, <span class="number">125</span>],</span><br><span class="line">        [<span class="number">32</span>, <span class="number">32</span>, <span class="number">7</span>, <span class="number">26</span>, <span class="number">41</span>, <span class="number">41</span>]</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 1: 解密RC4获取种子</span></span><br><span class="line">    box = init_sbox(key)</span><br><span class="line">    seed_bytes = decrypt(ciphertext, box.copy())</span><br><span class="line">    seed = <span class="built_in">int</span>(seed_bytes.decode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[+] 解密种子值: <span class="subst">{seed}</span>"</span>) <span class="comment"># 78910112</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 2: 恢复原始矩阵</span></span><br><span class="line">    original_matrix = transposed_matrix.T.reshape(-<span class="number">1</span>)  <span class="comment"># 转置恢复原始顺序</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 3: 生成随机数序列</span></span><br><span class="line">    random.seed(seed)</span><br><span class="line">    flag_chars = []</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> original_matrix:</span><br><span class="line">        rand_val = <span class="built_in">int</span>(<span class="built_in">str</span>(random.random() * <span class="number">10000</span>)[:<span class="number">2</span>])  <span class="comment"># 生成前两位数字</span></span><br><span class="line">        flag_char = <span class="built_in">chr</span>(rand_val ^ num)</span><br><span class="line">        flag_chars.append(flag_char)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 4: 组合flag</span></span><br><span class="line">    flag = <span class="string">''</span>.join(flag_chars)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n[+] 解密结果: <span class="subst">{flag}</span>"</span>) <span class="comment"># c570ee41-8b09-11ef-ac4a-a4b1c1c5a2d2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>flag{c570ee41-8b09-11ef-ac4a-a4b1c1c5a2d2}</code></p>
<h2 id="2essential"><a class="markdownIt-Anchor" href="#2essential"></a> 2.essential</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">a=getPrime(<span class="number">512</span>)</span><br><span class="line">p=sympy.nextprime(<span class="number">13</span>*a)</span><br><span class="line">q=sympy.prevprime(<span class="number">25</span>*a)</span><br><span class="line">number2=p*q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crypto01</span>(<span class="params">number1, number2, number3</span>):</span><br><span class="line">    number4 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> number2 &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> number2 % <span class="number">2</span>: </span><br><span class="line">            number4 = (number4 * number1) % number3</span><br><span class="line">        number1 = number1 ** <span class="number">2</span> % number3</span><br><span class="line">        number2 //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> number4</span><br><span class="line"><span class="comment"># n1^n2 mod n3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crypto02</span>(<span class="params">number1, number2</span>):</span><br><span class="line">    number3 = number1</span><br><span class="line">    number4 = number2</span><br><span class="line">    giao = <span class="number">1</span></span><br><span class="line">    giaogiao = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> number4 &gt; <span class="number">0</span>:</span><br><span class="line">        number7 = number3 // number4</span><br><span class="line">        giao, giaogiao = giaogiao, giao - giaogiao*number7</span><br><span class="line">        number3, number4 = number4, number3 - number4*number7</span><br><span class="line">    <span class="keyword">while</span> giao&lt;<span class="number">0</span>:</span><br><span class="line">        giao = giao + number2</span><br><span class="line">    <span class="keyword">return</span> giao</span><br><span class="line"><span class="comment">#pow(n1,-1,n2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crypto03</span>(<span class="params">number1, number2, number3</span>):</span><br><span class="line">    number4 = crypto01(number3, number1, number2)</span><br><span class="line">    <span class="keyword">return</span> number4</span><br><span class="line"><span class="comment"># n3^n1 mod n2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crypto05</span>(<span class="params">number1,number2</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(number1,<span class="number">0xe18e</span>,number2)</span><br><span class="line"><span class="comment"># n1^e mod n2</span></span><br><span class="line"></span><br><span class="line">number2 = <span class="number">20163906788220322201451577848491140709934459544530540491496316478863216041602438391240885798072944983762763612154204258364582429930908603435291338810293235475910630277814171079127000082991765275778402968190793371421104016122994314171387648385459262396767639666659583363742368765758097301899441819527512879933947</span></span><br><span class="line">number1 = <span class="number">6035830951309638186877554194461701691293718312181839424149825035972373443231514869488117139554688905904333169357086297500189578624512573983935412622898726797379658795547168254487169419193859102095920229216279737921183786260128443133977458414094572688077140538467216150378641116223616640713960883880973572260683</span></span><br><span class="line"></span><br><span class="line">number3 = <span class="built_in">int</span>.from_bytes(flag[<span class="number">0</span>:<span class="number">19</span>].encode(<span class="string">"utf-8"</span>), <span class="string">"big"</span>)</span><br><span class="line">number4 = <span class="built_in">int</span>.from_bytes(flag[<span class="number">19</span>:<span class="number">39</span>].encode(<span class="string">"utf-8"</span>), <span class="string">"big"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(crypto03(number1, number2, number3))</span><br><span class="line"><span class="built_in">print</span>(crypto05(number4,number2))</span><br><span class="line"><span class="comment">#6624758244437183700228793390575387439910775985543869953485120951825790403986028668723069396276896827302706342862776605008038149721097476152863529945095435498809442643082504012461883786296234960634593997098236558840899107452647003306820097771301898479134315680273315445282673421302058215601162967617943836306076  p1</span></span><br><span class="line"><span class="comment">#204384474875628990804496315735508023717499220909413449050868658084284187670628949761107184746708810539920536825856744947995442111688188562682921193868294477052992835394998910706435735040133361347697720913541458302074252626700854595868437809272878960638744881154520946183933043843588964174947340240510756356766  p2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>套层皮的RSA，crypto01计算的是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>n</mi><mn>1</mn><msub><mi>n</mi><mn>2</mn></msub></msubsup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><msub><mi>n</mi><mn>3</mn></msub><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
n_1^{n_2}\;mod\;n_3\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span></span></span></span></p>
<p>crypto02计算的是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>n</mi><mn>1</mn><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><msub><mi>n</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
n_1^{-1}\;mod\;n_2\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1205469999999997em;vertical-align:-0.256439em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4435610000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.256439em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span></span></span></span></p>
<p>crypto03计算的是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>n</mi><mn>3</mn><msub><mi>n</mi><mn>1</mn></msub></msubsup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><msub><mi>n</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
n_3^{n_1}\;mod\;n_2\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span></span></span></span></p>
<p>crypto05计算的是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>n</mi><mn>1</mn><mi>e</mi></msubsup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><msub><mi>n</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
n_1^e\;mod\;n_2\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9613919999999999em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span></span></span></span></p>
<p>这里给出了</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>=</mo><mi>p</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">
n_1=pq

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span></p>
<p>,注意到a就512位，且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&gt;</mo><mn>13</mn><mi>a</mi><mo separator="true">;</mo><mi>q</mi><mo>&lt;</mo><mn>25</mn><mi>a</mi></mrow><annotation encoding="application/x-tex">p&gt;13a;q&lt;25a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">3</span><span class="mord mathnormal">a</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord mathnormal">a</span></span></span></span>考虑到质数分步在500多位下都很密集，p应该很接近13a，q很接近25a，那么就可以对n1除去13*25再开根，得到一个a的初步估计，再尝试搜索出p,q的值，脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_a</span>(<span class="params">n</span>):</span><br><span class="line">    a_approx = gmpy2.isqrt(n // <span class="number">325</span>)</span><br><span class="line">    <span class="keyword">for</span> delta <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">1000</span>, <span class="number">1000</span>):  <span class="comment"># 搜索偏移范围</span></span><br><span class="line">        a_candidate = <span class="built_in">int</span>(a_approx) + delta</span><br><span class="line">        p = sympy.nextprime(<span class="number">13</span> * a_candidate)</span><br><span class="line">        q = sympy.prevprime(<span class="number">25</span> * a_candidate)</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            <span class="keyword">return</span> a_candidate, p, q</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">a, p, q = find_a(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"[+] Found a: <span class="subst">{a}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"p = <span class="subst">{p}</span>\nq = <span class="subst">{q}</span>"</span>)</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">[+] Found a: <span class="number">7876724580534791771835430594434627088013471560469412207736963203935537053220379418645369259714178145931522503674390087394035229717461111762112820042426110</span></span><br><span class="line">p = <span class="number">102397419546952293033860597727650152144175130286102358700580521651161981691864932442389800376284315897109792547767071136122457986326994452907466660551539601</span></span><br><span class="line">q = <span class="number">196918114513369794295885764860865677200336789011735305193424080098388426330509485466134231492854453648288062591859752184850880742936527794052820501060652747</span></span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<p>有了p,q之后就是很基础的RSA解明文了，注意到e与phi不互素，但是gcd很小，先试着用e//2算，实在不行再尝试有限域开根，所幸这里直接就算出来了,exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">102397419546952293033860597727650152144175130286102358700580521651161981691864932442389800376284315897109792547767071136122457986326994452907466660551539601</span></span><br><span class="line">q = <span class="number">196918114513369794295885764860865677200336789011735305193424080098388426330509485466134231492854453648288062591859752184850880742936527794052820501060652747</span></span><br><span class="line"></span><br><span class="line">number2 = <span class="number">20163906788220322201451577848491140709934459544530540491496316478863216041602438391240885798072944983762763612154204258364582429930908603435291338810293235475910630277814171079127000082991765275778402968190793371421104016122994314171387648385459262396767639666659583363742368765758097301899441819527512879933947</span></span><br><span class="line">number1 = <span class="number">6035830951309638186877554194461701691293718312181839424149825035972373443231514869488117139554688905904333169357086297500189578624512573983935412622898726797379658795547168254487169419193859102095920229216279737921183786260128443133977458414094572688077140538467216150378641116223616640713960883880973572260683</span></span><br><span class="line">c1 = <span class="number">6624758244437183700228793390575387439910775985543869953485120951825790403986028668723069396276896827302706342862776605008038149721097476152863529945095435498809442643082504012461883786296234960634593997098236558840899107452647003306820097771301898479134315680273315445282673421302058215601162967617943836306076</span></span><br><span class="line">c2 = <span class="number">204384474875628990804496315735508023717499220909413449050868658084284187670628949761107184746708810539920536825856744947995442111688188562682921193868294477052992835394998910706435735040133361347697720913541458302074252626700854595868437809272878960638744881154520946183933043843588964174947340240510756356766</span></span><br><span class="line"></span><br><span class="line">e=<span class="number">0xe18e</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(GCD(number1,phi))</span><br><span class="line">d1 = inverse(number1,phi)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d1,number2)</span><br><span class="line">d2 = inverse(e//<span class="number">2</span>,phi)</span><br><span class="line">M2 = <span class="built_in">pow</span>(c2,d2,number2)</span><br><span class="line">m2 = <span class="built_in">int</span>(gmpy2.iroot(M2,<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1)+long_to_bytes(m2))</span><br><span class="line"></span><br><span class="line"><span class="comment">#b'flag{75811c6d95770d56092817b75f15df05}'</span></span><br></pre></td></tr></table></figure>
<p><code>flag{75811c6d95770d56092817b75f15df05}</code></p>
<h2 id="3ez-calculate"><a class="markdownIt-Anchor" href="#3ez-calculate"></a> 3.EZ-calculate</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">flag1 = <span class="string">b'xxx'</span></span><br><span class="line">flag2 = <span class="string">b'xxx'</span></span><br><span class="line">Flags = <span class="string">'flag{'</span> + md5(flag1+flag2).hexdigest()[::-<span class="number">1</span>] + <span class="string">'}'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backpack_encrypt_flag</span>(<span class="params">flag_bytes, M, group_len</span>):</span><br><span class="line">    bits = []</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> flag_bytes:</span><br><span class="line">        bits.extend([<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">format</span>(byte, <span class="string">"08b"</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(bits) % group_len != <span class="number">0</span>:</span><br><span class="line">        bits.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    S_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bits), group_len):</span><br><span class="line">        group = bits[i:i + group_len]</span><br><span class="line">        S = <span class="built_in">sum</span>(bit * m <span class="keyword">for</span> bit, m <span class="keyword">in</span> <span class="built_in">zip</span>(group, M))</span><br><span class="line">        S_list.append(S)</span><br><span class="line">    <span class="keyword">return</span> S_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backpack</span>(<span class="params">flag_bytes</span>):</span><br><span class="line">    R = [<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(R) &lt; <span class="number">8</span>:</span><br><span class="line">        next_val = randint(<span class="number">2</span> * R[-<span class="number">1</span>], <span class="number">3</span> * R[-<span class="number">1</span>])</span><br><span class="line">        R.append(next_val)</span><br><span class="line">    B = randint(<span class="number">2</span> * R[-<span class="number">1</span>] + <span class="number">1</span>, <span class="number">3</span> * R[-<span class="number">1</span>])</span><br><span class="line">    A = getPrime(<span class="number">100</span>)</span><br><span class="line">    M = [A * ri % B <span class="keyword">for</span> ri <span class="keyword">in</span> R]</span><br><span class="line">    S_list = backpack_encrypt_flag(flag_bytes, M, <span class="built_in">len</span>(M))</span><br><span class="line">    <span class="keyword">return</span> R, A, B, M, S_list</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">0x10000</span></span><br><span class="line">m = bytes_to_long(flag1)</span><br><span class="line">k = randint(<span class="number">1</span>, <span class="number">999</span>)</span><br><span class="line">problem1 = (<span class="built_in">pow</span>(p,e,n)-<span class="built_in">pow</span>(q,e,n)) % n</span><br><span class="line">problem2 = <span class="built_in">pow</span>(p-q,e,n)*<span class="built_in">pow</span>(e,k,n)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line">R, A, B, M, S_list = backpack(flag2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r"C:\Users\Rebirth\Desktop\data.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f"problem1 = <span class="subst">{problem1}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"problem2 = <span class="subst">{problem2}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"n = <span class="subst">{n}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"c = <span class="subst">{c}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">"-------------------------\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"R = <span class="subst">{R}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"A = <span class="subst">{A}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"B = <span class="subst">{B}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"M = <span class="subst">{M}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"S_list = <span class="subst">{S_list}</span>\n"</span>)</span><br><span class="line">    f.write(<span class="string">"-------------------------\n"</span>)</span><br><span class="line">    f.write(<span class="string">f"What you need to submit is Flags!\n"</span>)</span><br></pre></td></tr></table></figure>
<p>part1</p>
<p>RSA,题目给出的是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msup><mi>p</mi><mi>e</mi></msup><mo>−</mo><msup><mi>q</mi><mi>e</mi></msup><mo stretchy="false">)</mo><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">p_1=(p^e-q^e)\;mod\;n\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span></span><span class="mspace newline"></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mi>q</mi><msup><mo stretchy="false">)</mo><mi>e</mi></msup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mtext>  </mtext><mtext>  </mtext><mo>∗</mo><mtext>  </mtext><mtext>  </mtext><msup><mi>e</mi><mi>k</mi></msup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">p_2=(p-q)^e\;mod\;n\;\;*\;\;e^k\;mod\;n\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8991079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span></span><span class="mspace newline"></span></span></span></span></p>
<p>这里我们的思路是枚举k的取值，计算出pow(e,k,n)之后用p2来除它，得到P，那么由二项式定理</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><msub><mi>p</mi><mn>2</mn></msub><mrow><msup><mi>e</mi><mi>k</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mi>n</mi></mrow></mfrac><mo>=</mo><mi>P</mi><mtext>  </mtext><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mi>q</mi><msup><mo stretchy="false">)</mo><mi>e</mi></msup><mtext>  </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mo>=</mo><msup><mi>p</mi><mi>e</mi></msup><mo>+</mo><msup><mi>q</mi><mi>e</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
\frac{p_2}{e^kmodn}=P\;=(p-q)^e\;mod\;n=p^e+q^emod\;n\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7935599999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7751079999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9088319999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9088319999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span></span><span class="mspace newline"></span></span></span></span></p>
<p>上下相加，容易得到</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><mi>P</mi><mo>=</mo><mn>2</mn><msup><mi>p</mi><mi>e</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext>  </mtext><mi>n</mi><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
p_1+P=2p^emod\;n\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9088319999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">n</span></span><span class="mspace newline"></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><mi>P</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">
p=gcd(p_1+P,n)\\

</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span><span class="mspace newline"></span></span></span></span></p>
<p>同样的方法我们也能枚举出q，再用位数和正负号作为制约就能爆破出p,q的值，脚本如下</p>
  <figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">problem1 = <span class="number">24819077530766367166035941051823834496451802693325219476153953490742162231345380863781267094224914358021972805811737102184859249919313532073566493054398702269142565372985584818560322911207851760003915310535736092154713396343146403645986926080307669092998175883480679019195392639696872929250699367519967334248</span></span><br><span class="line">problem2 = <span class="number">20047847761237831029338089120460407946040166929398007572321747488189673799484690384806832406317298893135216999267808940360773991216254295946086409441877930687132524014042802810607804699235064733393301861594858928571425025486900981252230771735969897010173299098677357738890813870488373321839371734457780977243838253195895485537023584305192701526016</span></span><br><span class="line">n = <span class="number">86262122894918669428795269753754618836562727502569381672630582848166228286806362453183099819771689423205156909662196526762880078792845161061353312693752568577607175166060900619163231849790003982326663277243409696279313372337685740601191870965951317590823292785776887874472943335746122798330609540525922467021</span></span><br><span class="line">c = <span class="number">74962027356320017542746842438347279031419999636985213695851878703229715143667648659071242394028952959096683055640906478244974899784491598741415530787571499313545501736858104610426804890565497123850685161829628373760791083545457573498600656412030353579510452843445377415943924958414311373173951242344875240776</span></span><br><span class="line">e=<span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    k = <span class="built_in">pow</span>(e,i,n)</span><br><span class="line">    Pr2 = problem2//k</span><br><span class="line">    <span class="comment"># print(isinstance(Pr2,int))</span></span><br><span class="line">    <span class="built_in">sum</span> = problem1+Pr2</span><br><span class="line">    sub = Pr2 - problem1</span><br><span class="line">    <span class="keyword">if</span> sub&gt;<span class="number">0</span> :</span><br><span class="line">        q = GCD(sub,n)</span><br><span class="line">        <span class="built_in">print</span>(q)</span><br><span class="line"><span class="comment"># 爆破p q</span></span><br><span class="line"><span class="comment">#p = 9586253455468582613875015189854230646329578628731744411408644831684238720919107792959420247980417763684885397749546095133107188260274536708721056484419031</span></span><br><span class="line"><span class="comment">#q = 8998523072192453101232205847855618180700579235012899613083663121402246420191771909612939404791268078655630846054784775118256720627970477420936836352759291</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后这里e是65536，不和phi互素，gcd是4，就考虑有限域开根然后用crt算可能的解了，脚本如下</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定参数</span></span><br><span class="line">p = <span class="number">9586253455468582613875015189854230646329578628731744411408644831684238720919107792959420247980417763684885397749546095133107188260274536708721056484419031</span></span><br><span class="line">q = <span class="number">8998523072192453101232205847855618180700579235012899613083663121402246420191771909612939404791268078655630846054784775118256720627970477420936836352759291</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65536</span></span><br><span class="line">c = <span class="number">74962027356320017542746842438347279031419999636985213695851878703229715143667648659071242394028952959096683055640906478244974899784491598741415530787571499313545501736858104610426804890565497123850685161829628373760791083545457573498600656412030353579510452843445377415943924958414311373173951242344875240776</span></span><br><span class="line">possible_m = []</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_rsa_with_coprime_e</span>(<span class="params">p, q, e, c</span>):</span><br><span class="line">    <span class="comment"># 计算模p和模q的c值</span></span><br><span class="line">    c_p = c % p</span><br><span class="line">    c_q = c % q</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理模p下的解</span></span><br><span class="line">    s_p = (p - <span class="number">1</span>) // <span class="number">2</span>  <span class="comment"># 因为p-1的2的指数为1</span></span><br><span class="line">    d_p = <span class="built_in">pow</span>(e, -<span class="number">1</span>, s_p)</span><br><span class="line">    m_p = <span class="built_in">pow</span>(c_p, d_p, p)</span><br><span class="line">    solutions_p = [m_p, (-m_p) % p]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理模q下的解</span></span><br><span class="line">    s_q = (q - <span class="number">1</span>) // <span class="number">2</span>  <span class="comment"># q-1的2的指数为1</span></span><br><span class="line">    d_q = <span class="built_in">pow</span>(e, -<span class="number">1</span>, s_q)</span><br><span class="line">    m_q = <span class="built_in">pow</span>(c_q, d_q, q)</span><br><span class="line">    solutions_q = [m_q, (-m_q) % q]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用CRT组合所有可能的解</span></span><br><span class="line">    <span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line">    possible_m = []</span><br><span class="line">    <span class="keyword">for</span> mp, mq <span class="keyword">in</span> product(solutions_p, solutions_q):</span><br><span class="line">        m = CRT([mp, mq], [p, q])</span><br><span class="line">        possible_m.append(m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> possible_m</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 执行解密</span></span><br><span class="line">possible_m = decrypt_rsa_with_coprime_e(p, q, e, c)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> possible_m:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b'CRYPTO_ALGORIT'</span></span><br></pre></td></tr></table></figure>
<p>不过跑出来b’CRYPTO_ALGORIT’就是第一个，有可能开根也能做呢</p>
<ul>
<li>
<p>part2</p>
<p>背包加密，不过该给的都给了，按照加密过程反过来写很快就能搞出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数</span></span><br><span class="line">R = [<span class="number">10</span>, <span class="number">29</span>, <span class="number">83</span>, <span class="number">227</span>, <span class="number">506</span>, <span class="number">1372</span>, <span class="number">3042</span>, <span class="number">6163</span>]</span><br><span class="line">A = <span class="number">1253412688290469788410859162653</span></span><br><span class="line">B = <span class="number">16036</span></span><br><span class="line">M = [<span class="number">10294</span>, <span class="number">12213</span>, <span class="number">10071</span>, <span class="number">4359</span>, <span class="number">1310</span>, <span class="number">4376</span>, <span class="number">7622</span>, <span class="number">14783</span>]</span><br><span class="line">S_list = [<span class="number">13523</span>, <span class="number">32682</span>, <span class="number">38977</span>, <span class="number">44663</span>, <span class="number">43353</span>, <span class="number">31372</span>, <span class="number">17899</span>, <span class="number">17899</span>, <span class="number">44663</span>, <span class="number">16589</span>, <span class="number">40304</span>, <span class="number">25521</span>, <span class="number">31372</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backpack_decrypt</span>(<span class="params">S_list, A, B, M</span>):</span><br><span class="line">    <span class="comment"># 1. 验证A与B互质</span></span><br><span class="line">    <span class="keyword">assert</span> math.gcd(A, B) == <span class="number">1</span>, <span class="string">"A and B must be coprime"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 计算A的模逆元</span></span><br><span class="line">    inv_A = <span class="built_in">pow</span>(A, -<span class="number">1</span>, B)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 恢复超递增序列R</span></span><br><span class="line">    R_recovered = [(m * inv_A) % B <span class="keyword">for</span> m <span class="keyword">in</span> M]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"恢复的R:"</span>, R_recovered)  <span class="comment"># 应等于原始R</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 解密每个S值</span></span><br><span class="line">    bits = []</span><br><span class="line">    <span class="keyword">for</span> S <span class="keyword">in</span> S_list:</span><br><span class="line">        <span class="comment"># 将S转换为超递增背包问题</span></span><br><span class="line">        S_prime = (S * inv_A) % B</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 贪心算法解背包</span></span><br><span class="line">        group = []</span><br><span class="line">        remaining = S_prime</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">reversed</span>(R_recovered):</span><br><span class="line">            <span class="keyword">if</span> remaining &gt;= r:</span><br><span class="line">                group.append(<span class="number">1</span>)</span><br><span class="line">                remaining -= r</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                group.append(<span class="number">0</span>)</span><br><span class="line">        bits.extend(group[::-<span class="number">1</span>])  <span class="comment"># 反转后加入</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 转换二进制为字节</span></span><br><span class="line">    bytes_data = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bits), <span class="number">8</span>):</span><br><span class="line">        byte_bits = bits[i:i+<span class="number">8</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(byte_bits) &lt; <span class="number">8</span>:</span><br><span class="line">            byte_bits += [<span class="number">0</span>]*(<span class="number">8</span> - <span class="built_in">len</span>(byte_bits))</span><br><span class="line">        byte = <span class="built_in">int</span>(<span class="string">''</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, byte_bits)), <span class="number">2</span>)</span><br><span class="line">        bytes_data += <span class="built_in">bytes</span>([byte])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. 去除填充的零</span></span><br><span class="line">    <span class="keyword">return</span> bytes_data.rstrip(<span class="string">b'\x00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行解密</span></span><br><span class="line">flag2 = backpack_decrypt(S_list, A, B, M)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"解密结果:"</span>, flag2.decode())</span><br><span class="line"><span class="comment"># HMS_WELL_DONE</span></span><br></pre></td></tr></table></figure>
<p>最后对两个flag拼接之后取md5，<code>flag{64f67374264b7621650b1de4dbc5f924}</code></p>
</li>
</ul>
<h2 id="4merge_ecc"><a class="markdownIt-Anchor" href="#4merge_ecc"></a> 4.merge_ECC</h2>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#t.sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">part1</span>():</span><br><span class="line">    p = random_prime(<span class="number">2</span>^<span class="number">512</span>, <span class="number">2</span>^<span class="number">513</span>)</span><br><span class="line">    a = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">    b = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">4</span> * a**<span class="number">3</span> + <span class="number">27</span> * b**<span class="number">2</span>) % p == <span class="number">0</span>:</span><br><span class="line">        a = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">        b = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    E = EllipticCurve(GF(p), [a, b])<span class="comment">#构造一个模p环下的关于a,b的椭圆曲线</span></span><br><span class="line"></span><br><span class="line">    P=E.random_point()<span class="comment">#曲线上的随机一个点</span></span><br><span class="line"></span><br><span class="line">    n = [random.randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">20</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] <span class="comment">#随机的一个点</span></span><br><span class="line">    <span class="keyword">assert</span> part1=<span class="string">''</span>.join([<span class="built_in">hex</span>(i)[<span class="number">2</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> n])</span><br><span class="line">    cipher = [n[i] * P <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"N = <span class="subst">{p}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"a = <span class="subst">{a}</span>, b = <span class="subst">{b}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"P = <span class="subst">{P}</span>"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"cipher<span class="subst">{i}</span> = <span class="subst">{cipher[i]}</span>"</span>)</span><br><span class="line"><span class="comment"># CRT</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">part2</span>():</span><br><span class="line">    p =  <span class="number">839252355769732556552066312852886325703283133710701931092148932185749211043</span></span><br><span class="line">    a =  <span class="number">166868889451291853349533652847942310373752202024350091562181659031084638450</span></span><br><span class="line">    b =  <span class="number">168504858955716283284333002385667234985259576554000582655928538041193311381</span></span><br><span class="line">    P = E.random_point()</span><br><span class="line">    Q = key*P</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"p = "</span>,p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a = "</span>,a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"b = "</span>,b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"P = "</span>,P)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Q = "</span>,Q)</span><br><span class="line">    <span class="keyword">assert</span> part2=key</span><br><span class="line">part1()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"-------------------------------------------"</span>)</span><br><span class="line">part2()</span><br><span class="line"><span class="keyword">assert</span> flag=<span class="string">"flag{"</span>+<span class="built_in">str</span>(part1)+<span class="string">"-"</span>+<span class="built_in">str</span>(part2)+<span class="string">"}"</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>考察的是有关ECC的两种特殊攻击方法</p>
<ul>
<li>
<p>part1</p>
<p>攻击的思路是Pohlig-Hellman攻击，要求是曲线的阶有小因数，这里E.order计算出来是512位，丢yafu分解之后发现有7个因子，其中5个比较小，且全部乘起来之后是比<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>要大的，因此我们就可以取小的5个因子来进行攻击，脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">8186762541745429544201163537921168767557829030115874801599552603320381728161178278432652391299286759969365150578265902315058515370390070500719061057476940</span></span><br><span class="line"><span class="built_in">print</span>(n.bit_length())</span><br><span class="line"><span class="comment"># 2*2*5*11*499*683*124696170958113532210068667*875618937758378886905025632349007870524674918888468835522805095350653442872611049093102429356717528012933133846029979343</span></span><br><span class="line"><span class="comment"># 椭圆曲线参数</span></span><br><span class="line">p = <span class="number">8186762541745429544201163537921168767557829030115874801599552603320381728161132002130533050721684554609459754424458805702284922582219134865036743485620797</span></span><br><span class="line">a = <span class="number">1495420997701481377470828570661032998514190598989197201754979317255564287604311958150666812378959018880028977121896929545639701195491870774156958755735447</span></span><br><span class="line">b = <span class="number">5991466901412408757938889677965118882508317970919705053385317474407117921506012065861844241307270755999163280442524251782766457119443496954015171881396147</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成元和密文点</span></span><br><span class="line">P = E(</span><br><span class="line">    <span class="number">6053058761132539206566092359337778642106843252217768817197593657660613775577674830119685211727923302909194735842939382758409841779476679807381619373546323</span>,</span><br><span class="line">    <span class="number">7059796954840479182074296506322819844555365317950589431690683736872390418673951275875742138479119268529134101923865062199776716582160225918885119415223226</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cipher0 = E(</span><br><span class="line">    <span class="number">4408587937721811766304285221308758024881057826193901720202053016482471785595442728924925855745045433966244594468163087104593409425316538804577603801023861</span>,</span><br><span class="line">    <span class="number">5036207336371623412617556622231677184152618465739959524167001889273208946091746905245078901669335908442289383798546066844566618503786766455892065155724816</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cipher1 = E(</span><br><span class="line">    <span class="number">2656427748146837510897512086140712942840881743356863380855689945832188909581954790770797146584513962618190767634822273749569907212145053676352384889228875</span>,</span><br><span class="line">    <span class="number">4010263650619965046904980178893999473955022015118149348183137418914551275841596653682626506158128955577872592363930977349664669161585732323838763793957500</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cipher2 = E(</span><br><span class="line">    <span class="number">1836350123050832793309451054411760401335561429787905037706697802971381859410503854213212757333551949694177845513529651742217132039482986693213175074097638</span>,</span><br><span class="line">    <span class="number">1647556471109115097539227566131273446643532340029032358996281388864842086424490493200350147689138143951529796293632149050896423880108194903604646084656434</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知阶的分解（排除最后两个大因子）</span></span><br><span class="line">primes = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">499</span>, <span class="number">683</span>]  <span class="comment"># 2^2, 5, 11, 499, 683</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pohlig_hellman</span>(<span class="params">P, Q, primes</span>):</span><br><span class="line">    dlogs = []</span><br><span class="line">    <span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">        t = P.order() // fac</span><br><span class="line">        PP = t * P</span><br><span class="line">        QQ = t * Q</span><br><span class="line">        dlog = PP.discrete_log(QQ)  <span class="comment"># 自动选择最佳算法</span></span><br><span class="line">        dlogs.append(dlog)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Factor: <span class="subst">{fac}</span>, Discrete Log: <span class="subst">{dlog}</span>"</span>)</span><br><span class="line">    <span class="keyword">return</span> crt(dlogs, primes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算三个离散对数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"计算n0:"</span>)</span><br><span class="line">n0 = pohlig_hellman(P, cipher0, primes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n计算n1:"</span>)</span><br><span class="line">n1 = pohlig_hellman(P, cipher1, primes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n计算n2:"</span>)</span><br><span class="line">n2 = pohlig_hellman(P, cipher2, primes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证结果</span></span><br><span class="line"><span class="keyword">assert</span> cipher0 == n0 * P</span><br><span class="line"><span class="keyword">assert</span> cipher1 == n1 * P</span><br><span class="line"><span class="keyword">assert</span> cipher2 == n2 * P</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接结果</span></span><br><span class="line">part1 = <span class="built_in">hex</span>(n0)[<span class="number">2</span>:] + <span class="built_in">hex</span>(n1)[<span class="number">2</span>:] + <span class="built_in">hex</span>(n2)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n解密结果:"</span>, part1)</span><br><span class="line"><span class="comment"># f61bd9f152e65ac</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>part2</p>
<p>smart攻击，这里曲线计算出来阶和模数相同，脚本如下</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p =  <span class="number">839252355769732556552066312852886325703283133710701931092148932185749211043</span></span><br><span class="line">a =  <span class="number">166868889451291853349533652847942310373752202024350091562181659031084638450</span></span><br><span class="line">b =  <span class="number">168504858955716283284333002385667234985259576554000582655928538041193311381</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">r = E.order()</span><br><span class="line"><span class="comment"># 839252355769732556552066312852886325703283133710701931092148932185749211043</span></span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line">P =  E(<span class="number">547842233959736088159936218561804098153493246314301816190854370687622130932</span> , <span class="number">259351987899983557442340376413545600148150183183773375317113786808135411950</span> )</span><br><span class="line">Q =  E(<span class="number">52509027983019069214323702207915994504051708473855890224511139305828303028</span> , <span class="number">520507172059483331872189759719244369795616990414416040196069632909579234481</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">r = SmartAttack(P, Q, p)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7895892011</span></span><br></pre></td></tr></table></figure>
<p><code>flag{f61bd9f152e65ac-7895892011}</code></p>
</li>
</ul>
<h2 id="5logos"><a class="markdownIt-Anchor" href="#5logos"></a> *5.logos</h2>
<p>2023赣政杯原题，这里是别的师傅写的博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/luochen2436/article/details/132332081">2023赣政杯 — Crypto_赣政杯2023-CSDN博客</a></p>
<p>还在被sagemath各种环境问题折磨，就暂时不细写了</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/Crypto/" rel="tag"># Crypto</a>
              <a href="/tags/DLP/" rel="tag"># DLP</a>
              <a href="/tags/ECC/" rel="tag"># ECC</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/04/19/XYCTF2025/" rel="prev" title="XYCTF2025">
      <i class="fa fa-chevron-left"></i> XYCTF2025
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/04/22/TGCTF2025/" rel="next" title="TGCTF2025">
      TGCTF2025 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1xr4"><span class="nav-number">1.</span> <span class="nav-text"> 1.XR4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2essential"><span class="nav-number">2.</span> <span class="nav-text"> 2.essential</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3ez-calculate"><span class="nav-number">3.</span> <span class="nav-text"> 3.EZ-calculate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4merge_ecc"><span class="nav-number">4.</span> <span class="nav-text"> 4.merge_ECC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5logos"><span class="nav-number">5.</span> <span class="nav-text"> *5.logos</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Misay</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zt2misay2" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zt2misay2" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Misay</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
